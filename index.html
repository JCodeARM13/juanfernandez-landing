<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protocolo VIERNES - Acceso Restringido</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #000;
      color: #f5f5f7;
      overflow: hidden;
    }
    .fade-in { animation: fadeIn 1s ease-in-out forwards; }
    .fade-out { animation: fadeOut 1s ease-in-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    @keyframes fadeOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.98); visibility: hidden; } }

    /* Estilos para la intro tipo Matrix */
    #matrix-screen {
        font-family: 'Roboto Mono', monospace;
        color: #00ff41; /* Verde Matrix */
    }
    .blinking-cursor {
        animation: blink 1s step-end infinite;
    }
    @keyframes blink {
        from, to { border-right-color: transparent; }
        50% { border-right-color: #00ff41; }
    }

    /* Estilos del chat */
    .chat-bubble { max-width: 75%; padding: 12px 18px; border-radius: 20px; line-height: 1.5; }
    .chat-bubble.user { background-color: #0071E3; color: white; border-bottom-right-radius: 4px; }
    .chat-bubble.ai { background-color: #2c2c2e; color: #f5f5f7; border-bottom-left-radius: 4px; }
    .chat-input:focus { outline: none; border-color: #0071E3; box-shadow: 0 0 0 2px rgba(0, 113, 227, 0.5); }
    
    /* Estilo para "escribiendo..." */
    .typing-indicator span { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background-color: #8a8a8e; animation: typing 1s infinite; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
  </style>
</head>
<body class="w-screen h-screen">

  <!-- Pantalla de Intro "Matrix" -->
  <div id="matrix-screen" class="w-full h-full flex items-center justify-center p-4 z-20 absolute top-0 left-0 bg-black">
    <div class="w-full max-w-2xl">
        <pre id="matrix-text" class="text-sm md:text-lg whitespace-pre-wrap"></pre>
    </div>
  </div>

  <!-- Pantalla de Contraseña (inicialmente invisible) -->
  <div id="login-screen" class="w-full h-full flex flex-col items-center justify-center p-4 z-10 absolute top-0 left-0 bg-black opacity-0">
    <div class="text-center w-full max-w-md">
      <i class="fas fa-shield-alt text-5xl text-blue-500 mb-6"></i>
      <h1 class="text-3xl md:text-4xl font-bold mb-2">Protocolo VIERNES</h1>
      <p class="text-lg text-gray-400 mb-8">Acceso restringido. Por favor, identifíquese.</p>
      <form id="password-form" class="w-full">
        <input type="password" id="password-input" class="w-full bg-gray-800 border border-gray-600 text-white text-lg rounded-lg p-4 mb-4 text-center focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition" placeholder="Contraseña">
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-lg py-4 rounded-lg transition-transform transform hover:scale-105">Desbloquear</button>
      </form>
      <p id="error-message" class="text-red-500 mt-4 h-6"></p>
    </div>
  </div>

  <!-- Interfaz de Chat (oculta inicialmente) -->
  <div id="chat-container" class="w-full h-full flex flex-col opacity-0 hidden">
    <header class="p-4 border-b border-gray-700 text-center">
      <h2 class="text-xl font-bold">VIERNES <span class="text-blue-500">AI</span></h2>
      <p class="text-sm text-gray-400">Asistente Profesional de Juan Carlos Fernández</p>
    </header>
    
    <main id="chat-log" class="flex-1 p-4 md:p-6 space-y-6 overflow-y-auto">
      <div class="flex items-start gap-3 justify-start">
        <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><i class="fas fa-robot text-blue-400"></i></div>
        <div class="chat-bubble ai">
          <p>Protocolo VIERNES desbloqueado. Soy el asistente de IA de Juan Carlos. ¿En qué puedo ayudarte hoy? Puedes preguntarme sobre su experiencia, proyectos o habilidades.</p>
        </div>
      </div>
    </main>

    <footer class="p-4 border-t border-gray-700">
      <form id="chat-form" class="flex items-center gap-4">
        <input type="text" id="user-input" class="flex-1 bg-gray-800 border border-gray-600 text-white rounded-full py-3 px-5 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition" placeholder="Escribe tu pregunta aquí..." autocomplete="off">
        <button type="submit" id="send-button" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-12 h-12 flex items-center justify-center transition-transform transform hover:scale-110">
          <i class="fas fa-paper-plane"></i>
        </button>
      </form>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const matrixScreen = document.getElementById('matrix-screen');
      const matrixTextElement = document.getElementById('matrix-text');
      const loginScreen = document.getElementById('login-screen');
      const passwordForm = document.getElementById('password-form');
      const passwordInput = document.getElementById('password-input');
      const errorMessage = document.getElementById('error-message');
      const chatContainer = document.getElementById('chat-container');
      const chatLog = document.getElementById('chat-log');
      const chatForm = document.getElementById('chat-form');
      const userInput = document.getElementById('user-input');

      const CORRECT_PASSWORD = 'VIERNES13';

      /**
       * ---------------------------------------------------
       * 1. INTRODUCCIÓN ESTILO MATRIX
       * ---------------------------------------------------
       */
      function typeWriter(text, element, index, callback) {
        if (index < text.length) {
          element.innerHTML = text.substring(0, index + 1) + '<span class="blinking-cursor border-r-2"></span>';
          setTimeout(() => typeWriter(text, element, index + 1, callback), 60);
        } else {
            element.innerHTML = text; // Quitar el cursor al final
            if (callback) callback();
        }
      }

      function runMatrixIntro() {
        const platform = navigator.platform || 'Desconocido';
        const language = navigator.language || 'Desconocido';
        const now = new Date();
        const timeString = now.toLocaleTimeString();

        const lines = [
            'Wake up, user...',
            'A signal has been detected.',
            `> Origin: ${platform}`,
            `> Language: ${language}`,
            `> Timestamp: ${timeString}`,
            'The matrix has you.',
            'Follow the white rabbit.',
            'It is time to see how deep the rabbit hole goes.',
            'Identify yourself to proceed...'
        ];
        
        let lineIndex = 0;
        
        function typeNextLine() {
            if (lineIndex < lines.length) {
                const p = document.createElement('p');
                matrixTextElement.appendChild(p);
                typeWriter(lines[lineIndex], p, 0, () => {
                    lineIndex++;
                    setTimeout(typeNextLine, 500); // Pausa entre líneas
                });
            } else {
                // Transición a la pantalla de login
                setTimeout(() => {
                    matrixScreen.classList.add('fade-out');
                    loginScreen.classList.remove('opacity-0');
                    loginScreen.classList.add('fade-in');
                }, 1500); // Pausa final antes de la transición
            }
        }
        
        typeNextLine();
      }

      runMatrixIntro(); // Iniciar la secuencia de introducción

      /**
       * ---------------------------------------------------
       * 2. MANEJO DE LA CONTRASEÑA
       * ---------------------------------------------------
       */
      passwordForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (passwordInput.value === CORRECT_PASSWORD) {
          console.log('Acceso concedido');
          loginScreen.classList.remove('fade-in');
          loginScreen.classList.add('fade-out');
          chatContainer.classList.remove('hidden');
          setTimeout(() => {
            chatContainer.classList.add('fade-in');
          }, 100);
        } else {
          errorMessage.textContent = 'Contraseña incorrecta. Inténtalo de nuevo.';
          passwordInput.classList.add('border-red-500');
          setTimeout(() => {
            errorMessage.textContent = '';
            passwordInput.classList.remove('border-red-500');
          }, 2000);
        }
      });

      /**
       * ---------------------------------------------------
       * 3. LÓGICA DEL CHAT CON IA
       * ---------------------------------------------------
       */
      const chatHistory = [];
      const CV_CONTEXT = `
        Tú eres VIERNES, un asistente de IA profesional para Juan Carlos Fernández Varela Gómez. Tu propósito es responder preguntas sobre su carrera basándote en la siguiente información de su CV. Eres cortés, profesional y directo.

        **Información Clave del CV:**
        - **Nombre:** Juan Carlos Fernández Varela Gómez
        - **Puesto Actual:** Team Vendor Lead en Lyft.
        - **Experiencia:** Más de 7 años en implementación de proyectos, ventas, servicio al cliente y gestión digital.
        - **Educación:** Licenciatura en Economía por la UNAM (SUAYED).
        - **Idiomas:** Español (Nativo), Inglés (C1+), Portugués.
        - **Empresas Anteriores y Logros:**
            - **inDrive (Supervisor of Special Branches LATAM):**
                - Lideró equipos online/offline en México y Centroamérica, superando metas de reclutamiento (+100%) con 33% de conversión.
                - Gestionó la alianza B2B con IKEA, mejorando su logística en un 43%.
                - Realizó viajes de negocio estratégicos a Guatemala y Jamaica.
                - Diseñó campañas de marketing en Meta Ads y Google Ads.
            - **Verizon (Team Leader, Customer Service):**
                - Lideró un equipo de servicio al cliente y ventas por chat, enfocado en KPIs de conversión y satisfacción.
            - **Kavak.com (Team Leader, Back-office/Digital Contracts):**
                - Lideró la transformación digital, llevando la adopción de contratos sin papel del 0% al 97%.
                - Utilizó Salesforce y Netsuite.
        - **Habilidades y Certificaciones:**
            - **Gestión:** Liderazgo de Equipos, Gestión de Proyectos, Estrategia de Negocio.
            - **Técnicas:** Análisis de Datos, Salesforce, Meta/Google Ads, Innovación con IA.
            - **Certificaciones (Platzi):** Introducción a la IA, ChatGPT, Historia del Dinero.

        Responde a las preguntas del usuario basándote únicamente en esta información. Si te preguntan algo fuera de este contexto, amablemente indica que tu conocimiento se limita a la trayectoria profesional de Juan Carlos.
      `;
      
      chatHistory.push({ role: "system", parts: [{ text: CV_CONTEXT }] });

      chatForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const userMessage = userInput.value.trim();
        if (!userMessage) return;

        appendMessage(userMessage, 'user');
        userInput.value = '';
        
        showTypingIndicator();
        
        try {
            const aiResponse = await getAIResponse(userMessage);
            removeTypingIndicator();
            appendMessage(aiResponse, 'ai');
        } catch (error) {
            removeTypingIndicator();
            appendMessage('Lo siento, estoy teniendo problemas para conectar con mis sistemas en este momento. Por favor, inténtalo de nuevo más tarde.', 'ai');
            console.error('Error fetching AI response:', error);
        }
      });
      
      function appendMessage(text, sender) {
        const messageWrapper = document.createElement('div');
        const icon = document.createElement('div');
        const bubble = document.createElement('div');

        messageWrapper.className = `flex items-start gap-3 ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
        icon.className = 'w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center flex-shrink-0';
        bubble.className = `chat-bubble ${sender}`;
        
        if (sender === 'user') {
            icon.innerHTML = '<i class="fas fa-user text-gray-400"></i>';
            bubble.textContent = text;
            messageWrapper.append(bubble, icon);
        } else {
            icon.innerHTML = '<i class="fas fa-robot text-blue-400"></i>';
            bubble.textContent = text;
            messageWrapper.append(icon, bubble);
        }
        
        chatLog.appendChild(messageWrapper);
        chatLog.scrollTop = chatLog.scrollHeight;
      }
      
      function showTypingIndicator() {
        const typingWrapper = document.createElement('div');
        typingWrapper.id = 'typing-indicator';
        typingWrapper.className = 'flex items-start gap-3 justify-start';
        typingWrapper.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center"><i class="fas fa-robot text-blue-400"></i></div>
            <div class="chat-bubble ai typing-indicator">
                <span></span><span></span><span></span>
            </div>
        `;
        chatLog.appendChild(typingWrapper);
        chatLog.scrollTop = chatLog.scrollHeight;
      }

      function removeTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
      }

      async function getAIResponse(prompt) {
          chatHistory.push({ role: "user", parts: [{ text: prompt }] });
          
          const payload = {
            contents: chatHistory,
            generationConfig: {
              temperature: 0.7,
              topK: 1,
              topP: 1,
              maxOutputTokens: 2048,
            },
          };

          const apiKey = ""; // La API key se gestiona automáticamente en el entorno de Canvas
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
          
          const response = await fetch(apiUrl, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
          });

          if (!response.ok) throw new Error(`API request failed with status ${response.status}`);

          const result = await response.json();
          
          if (result.candidates && result.candidates[0]?.content?.parts[0]) {
            const aiText = result.candidates[0].content.parts[0].text;
            chatHistory.push({ role: "model", parts: [{ text: aiText }] });
            return aiText;
          } else {
            console.warn('No content received from AI:', result);
            return 'No he podido procesar esa solicitud. ¿Podrías reformular tu pregunta?';
          }
      }
    });
  </script>

</body>
</html>
